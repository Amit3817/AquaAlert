const express=require("express");
const authController=require("../controller/authController");
const { body }=require("express-validator");
const tokenverify=require("../middleware/isauth");
const mailer=require("../middleware/mailer");



const router=express.Router();

router.post('/signup',
[
   body('email','Please enter a valid mail')
   .normalizeEmail()
   .not()
    .isEmpty()

,
    body('password','Please enter valid password')
    .trim()
    .isLength({min:8}),

    body('name','Please enter valid name')
    .trim()
    .isLength({min:2})

],authController.signUp,mailer.sent);

router.post('/login',
[
  body('email','Please enter a valid mail')
  .normalizeEmail()
  .not()
   .isEmpty()

,
   body('password','Please enter valid password')
   .trim()
  .not()
  .isEmpty()
],authController.logIn);
  

  router.post('/forgotpassword',
  [
    body('email','Please enter a valid mail')
    .normalizeEmail()
    .not()
     .isEmpty()
  ],authController.forgotPassword,mailer.sent);



  router.post('/otpverify',
  [


    body('otp','Please enter a valid otp')
    .not()
     .isEmpty()


  ],tokenverify.verifytoken,authController.otpVerify);


  router.put('/resendotp',tokenverify.verifytoken,mailer.sent);


  router.put('/changepassword',
  [
    body('newpassword','Please enter a valid mail')
    .not()
    .isEmpty(),
  ],tokenverify.verifytoken,authController.changePassword);

    

module.exports=router;

